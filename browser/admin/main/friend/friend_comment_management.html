<p id="top"></p>

<div class="slides">
	<ul class="slideul">
		<li>
			<a href="#63">
				<img src="../../img/new.png" />
				<!--<br>新建消息-->
			</a>
		</li>
		<li>
			<a href="#top">
				<img src="../../img/top.png" />
				<!--<br>返回顶部-->
			</a>
		</li>
	</ul>
</div>
<script>
	//JavaScript代码区域
	layui.use('element', function() {
		var element = layui.element;
//		element.render();
	});
	layui.use('form', function() {
		var form = layui.form;
	});
	var n = 0;
	$(function() {
		var col1 = '<div name="img" class="layui-col-md1"><img src="%1" class="enter_face" /></div>';
		var col2 = '<div name="item" class="layui-col-md4">' +
			'		<p style="font-weight: bold;" id="user">%1</p>' +
			'		<div name="content">' +
			'			<p name="description">%2</p>' +
			'				%3' +
			'			<p class="show-time" id="show-time">%4</p>' +
			'		</div>' +
			'	</div>' +
			'	<div class="layui-col-md1">' +
			'		<i class="layui-icon layui-icon-delete" style="font-size: 24px; color: #009F95;"></i>' +
			'	</div>';
		var col4 = '<div class="layui-col-md5 comments">' +
			'		<br>' +
			'		<p style="font-weight: bold;" name="user">评论管理</p>' +
			'		%1' +
			'	</div>';
		var commentitem = '<div class="comments-item layui-row">' +
			'			<div class="layui-col-md11 comment-item ">' +
			'				<span class="comment-name">%1</span>：' +
			'				<span class="comment-content">%2</span>' +
			'			</div>' +
			'			<div class="layui-col-md1">' +
			'				<i class="layui-icon layui-icon-delete" style="font-size: 20px; color: #009F95;"></i>' +
			'			</div>' +
			'		</div>';
		var layuicard = '<div class="layui-card"><div class="layui-card-body"><div class="layui-row">%1 %2 %3</div></div></div>';
		
		$.ajax({
			type: "get",
			url: "../../json/friend.json",
			//					url: "http://127.0.0.1:8020/admin/json/friend.json",
			async: false,
			//					dataType: "text",
			dataType: "json",
			//					contentType: 'application/json',
			success: function(data) {
				var innerHtml = "";
				//						console.log(data);	
				for(var d in data) {
					console.log("--------------------------");
					console.log(data[d]);
					var imgs_content = '<div id="friendpics' + d + '">';
					var imgurls = data[d].imgurls;
					var img_class = 'messagelist-imgs' + imgurls.length;
					var num = numperrow(imgurls.length);
					for(var i in imgurls) {
						imgs_content += '<span class="' + img_class + '" style="background-image: url(' + imgurls[i] + ');"><img src="' + imgurls[i] + '" style="opacity: 0;" /></span>';
						//								imgs_content += '<span class="' + img_class + '"><img src="' + imgurls[i] + '" /></span>';
						//								imgs_content += '<div style="background-image: url(' + imgurls[i] + ');"></div>';
						if((i + 1) % num == 0) {
							imgs_content += '<br>';
							console.log("(" + i + "+1 ) % " + num + " = " + (i + 1) % num);

						} else {
							console.log("(" + i + "+1 ) % " + num + " = " + (i + 1) % num);
						}
					};
					imgs_content += '</div>';

					var comments = '';
					var comments_data = data[d].comments;
					for(var i in comments_data) {
						comments += String.format(
							commentitem,
							comments_data[i].name,
							comments_data[i].comment
						);
					}
					innerHtml += String.format(
						layuicard,
						String.format(
							col1,
							data[d].logo
						),
						String.format(
							col2,
							data[d].name,
							data[d].content,
							imgs_content,
							data[d].stime
						),
						String.format(
							col4,
							comments
						)
					);
					n = d;
//					alert(n);
				}
				$('#top').append(innerHtml);
			},
			error: function() {
				alert("error");
			}
		});
		return false;
	});
	layui.use('layer', function() {
			var layer = layui.layer;
			// 				layer.msg("hhh");
			$(function() {
				for(var i=0; i<=n; i++) {
					var id_ = '#friendpics' + i;
					layer.photos({
						photos: id_,
						anim: 5 //0-6的选择，指定弹出图片动画类型，默认随机（请注意，3.0之前的版本用shift参数）
					});
				}
			});
		});
</script>