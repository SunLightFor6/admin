<div class="body-in" id="top">
	<div class="layui-card-body">
		<blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px;">
			现有的轮播图：
			<div id="current_pics"></div>
		</blockquote>
		<script>
			$(function() {
//						$('#current_pics').append('<img src="' + '../../img/11.jpg' + '"class="layui-upload-img" style="height: 150px; width: 240px" />');
//						$('#current_pics').append('<img src="' + '../../img/11.jpg' + '"class="layui-upload-img" style="height: 150px; width: 240px" />');
//						$('#current_pics').append('<img src="' + '../../img/11.jpg' + '"class="layui-upload-img" style="height: 150px; width: 240px" />');
						jqxhr = $.ajax({
									type: "get",
									url: PREPATH + "/admin/selectTeacherSwiperByQID",
									async: true,
									processData: false,
									contentType: false,
									dataType: "json",
									success: function(data) {
										$.each(data, function(name, value) {
												$('#current_pics').append('<img src="' + IMGPATH + value + '"class="layui-upload-img" style="height: 150px; width: 240px" />');
										});
									}
									});
							})
		</script>
		<form class="layui-form" name="message_form" action="" method="post" enctype="multipart/form-data">
			<p class="form-label">上传轮播图</p>
			<div class="layui-upload">
				<button type="button" class="layui-btn layui-btn-primary" id="uploadpics">选择图片</button>
				<!--<blockquote id="teacher_pic" class="layui-elem-quote layui-quote-nm" style="display: none; margin-top: 10px;">
					<!--预览图：-->
					<!--<div class="layui-upload-list" id="pics">-->
					<!--<div id="pics" style="clear:both;"></div>	
						
						
					<!--</div>-->
				<!--</blockquote>-->
			
			<blockquote id="teacher_pic" class="layui-elem-quote layui-quote-nm" style="display:none; margin-top: 10px;">
		<!--<blockquote id="teacher_pic" class="layui-elem-quote layui-quote-nm" style="display: none; margin-top: 10px;">-->
					预览图：
					<div class="layui-upload-list" id="pics">
					<div id="pics"></div>	
						
						
					</div>
				</blockquote>
			
			
			</div>
			<p class="form-label"></p>
			<button type="button" id="submit_t_pics" class="layui-btn">确定更新轮播图</button>
		</form>
		
		
				
	</div>
</div>

<script>
	//JavaScript代码区域
	layui.use('element', function() {
		var element = layui.element;

	});
</script>
<script>
	var imgs = new Array(),
		pics_map = new Map(); //所有图片的集合
	layui.use('upload', function() {
		var $ = layui.jquery,
			upload = layui.upload;
		//多图片上传
		upload.render({
			elem: '#uploadpics',
			auto: false,
			multiple: true,
			acceptMime: 'image/*',
			number: 3,
			size: 1000 //限制文件大小，单位 KB
				,
			choose: function(obj) {
				$('#teacher_pic').show();
				//预读本地文件示例，不支持ie8
				obj.preview(function(index, file, result) {
					imgs.push(file);
					pics_map.set(index, file);
//					$('#pics').append('<div class="layui-col-lg2"><span class="layui-badge" style="position: absolute;" id="b_' + index + '">X</span>' +
//						'<img id="img_o_' + index + '" src="' + result + '" alt="' + file.name + '" class="layui-upload-img" style="height: 150px; width: 240px">')
					$('#pics').append(
//						'<img src="' + result + '" class="layui-upload-img" style="height: 150px; width: 240px" />'
						
						'<img id="img_o_' + index + '" src="' + result + '" alt="' + file.name + '" class="layui-upload-img" style="height: 150px; width: 240px">')

					$('#b_' + index).click(function() {
						$('#img_o_' + index).remove();
						$('#b_' + index).remove();
						message_pics.splice(message_pics.indexOf(pics_map.get(index)), 1);
						console.log(message_pics);
						console.log(pics_map);
					});
				});
			},
			done: function(res) {
				//上传完毕
			}
		});
	});

	$('#submit_t_pics').click(function() {
		var formData = new FormData();
		console.log("imgs");
		console.log(imgs);
		for(var i in imgs) {
			formData.append("imgs", imgs[i]);
		}
		console.log(formData.getAll('imgs'));
		jqxhr = jqxhr = $.ajax({
			type: "post",
			url: PREPATH + "/admin/updateTeacherSwiperByQID",
			async: true,
			data: formData,
			dataType: "json",
			processData: false,
			contentType: false,
			success: function(data) {
				if(data.response == 1) {
					layer.open({
						type: 0,
						btn: false,
						title: false,
						icon: 6,
						closeBtn: 0,
						shadeClose: true,
						time: 1500,
						content: '更新成功！'
					});
					window.location.href = "#32";
				} else {
					layer.open({
						type: 0,
						btn: false,
						title: false,
						icon: 5,
						closeBtn: 0,
						shadeClose: true,
						time: 1500,
						content: '更新失败，请稍后重试'
					});
				}
			},
			error: function() {
				layer.open({
					type: 0,
					btn: false,
					title: false,
					icon: 5,
					closeBtn: 0,
					shadeClose: true,
					time: 1500,
					content: '服务器错误，请稍后重试'
				});
			}
		});
	});
</script>